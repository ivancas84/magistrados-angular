<form [formGroup]="uploadForm" (ngSubmit)="onSubmit()" novalidate autocomplete="off">

<mat-card *ngIf="!response">
  <mat-card-header>
    <mat-card-title>Procesar Archivo de Sueldos</mat-card-title>
  </mat-card-header>
  <mat-card-content>
    <div fxLayout="row" fxFlex="auto" fxLayoutGap="10px" fxLayout.xs="column">
      <core-input-ym *ngIf="periodo" fxFlex="auto" [field]="periodo" [title]="'Período'"></core-input-ym>

      <core-input-select fxFlex="auto" [field]="organo" [entityName]="'organo'" [title]="'Organo'"></core-input-select>
      <div fxFlex="auto">
        <mat-form-field>
          <mat-label>Archivo</mat-label>
          <ngx-mat-file-input #removableInput formControlName="file" placeholder="Archivo" [accept]="'.txt,.dat'"></ngx-mat-file-input>
          <button mat-icon-button matSuffix *ngIf="!removableInput.empty" (click)="removableInput.clear($event)">
            <mat-icon>clear</mat-icon>
          </button>
          <mat-error *ngIf="file.hasError('required')">Debe completar valor</mat-error>
        </mat-form-field>
      </div>
    </div>
  </mat-card-content>
</mat-card>
<mat-card *ngIf="!response">
  <mat-card-content>
    <button mat-raised-button [disabled]="uploadForm.pending || isSubmitted" type="submit" color="primary">Aceptar</button>&nbsp;
    <button mat-mini-fab color="accent" type="button"  (click)="back()"><mat-icon>keyboard_backspace</mat-icon></button>
    <button mat-mini-fab color="accent" type="button" (click)="reset()"><mat-icon>clear_all</mat-icon></button>
  </mat-card-content>
</mat-card>
</form>

<mat-progress-bar *ngIf="!response && isSubmitted" mode="indeterminate"></mat-progress-bar>


<mat-card *ngIf="response">
  <mat-card-header>
    <mat-card-title>
      <mat-card-title>Resultado procesamiento {{response["evaluado"] | toDate | date:"M/y"}}</mat-card-title>
    </mat-card-title>
  </mat-card-header>
  <mat-card-content>
    <h3>Registros 40</h3>
    <mat-accordion>
      <mat-expansion-panel>
        <mat-expansion-panel-header>
          <mat-panel-title>
            Altas existentes {{response["afiliacion"]["altas_existentes"].length}}
          </mat-panel-title>
          <mat-panel-description>
            Registros 40 existentes que están en el archivo de sueldos
          </mat-panel-description>
        </mat-expansion-panel-header>
        <mat-list role="list">
          <mat-list-item *ngFor="let r of response['afiliacion']['altas_existentes']" role="listitem">
            <a target="_blank" [routerLink]="['/persona-admin']" [queryParams]="{legajo:r.per_legajo}">{{r.per_legajo}} {{r.per_nombres}} {{r.per_apellidos}}</a>
          </mat-list-item>
        </mat-list>
      </mat-expansion-panel>

      <mat-expansion-panel>
        <mat-expansion-panel-header>
          <mat-panel-title>
            Altas aprobadas {{response['afiliacion']["altas_aprobadas"].length}}
          </mat-panel-title>
          <mat-panel-description>
            Registros 40 enviados que están en el archivo de sueldos
          </mat-panel-description>
        </mat-expansion-panel-header>
        <mat-list role="list">
          <mat-list-item *ngFor="let r of response['afiliacion']['altas_aprobadas']" role="listitem">
            <a target="_blank" [routerLink]="['/persona-admin']" [queryParams]="{legajo:r.per_legajo}">{{r.per_legajo}} {{r.per_nombres}} {{r.per_apellidos}}</a>
          </mat-list-item>
        </mat-list>
      </mat-expansion-panel>
    
    
    <mat-expansion-panel>
      <mat-expansion-panel-header>
        <mat-panel-title>
          Altas rechazadas {{response['afiliacion']["altas_rechazadas"].length}}
        </mat-panel-title>
        <mat-panel-description>
          Registros 40 enviados que no están en el archivo de sueldos
        </mat-panel-description>
      </mat-expansion-panel-header>
      <mat-list role="list">
        <mat-list-item *ngFor="let r of response['afiliacion']['altas_rechazadas']" role="listitem">
          <a target="_blank" [routerLink]="['/persona-admin']" [queryParams]="{legajo:r.per_legajo}">{{r.per_legajo}} {{r.per_nombres}} {{r.per_apellidos}}</a>
        </mat-list-item>
      </mat-list>
    </mat-expansion-panel>

    <mat-expansion-panel>
      <mat-expansion-panel-header>
        <mat-panel-title>
          Altas automáticas {{response['afiliacion']["altas_automaticas"].length}}
        </mat-panel-title>
        <mat-panel-description>
          Registros 40 no enviados que están en el archivo de sueldos
        </mat-panel-description>
      </mat-expansion-panel-header>
      <mat-list role="list">
        <mat-list-item *ngFor="let r of response['afiliacion']['altas_automaticas']" role="listitem">
          <a target="_blank" [routerLink]="['/persona-admin']" [queryParams]="{legajo:r.legajo}">{{r.legajo}} {{r.nombres}} {{r.apellidos}}</a>
        </mat-list-item>
      </mat-list>
    </mat-expansion-panel>


    <mat-expansion-panel>
      <mat-expansion-panel-header>
        <mat-panel-title>
          Bajas automáticas {{response['afiliacion']["bajas_automaticas"].length}}
        </mat-panel-title>
        <mat-panel-description>
          Registros 40 existentes que no están en el archivo de sueldos
        </mat-panel-description>
      </mat-expansion-panel-header>
      <mat-list role="list">
        <mat-list-item *ngFor="let r of response['afiliacion']['bajas_automaticas']" role="listitem">
          <a target="_blank" [routerLink]="['/persona-admin']" [queryParams]="{legajo:r.per_legajo}">{{r.per_legajo}} {{r.per_nombres}} {{r.per_apellidos}}</a>
        </mat-list-item>
      </mat-list>
    </mat-expansion-panel>

    <mat-expansion-panel>
      <mat-expansion-panel-header>
        <mat-panel-title>
          Bajas aprobadas {{response['afiliacion']["bajas_aprobadas"].length}}
        </mat-panel-title>
        <mat-panel-description>
          Registros 40 dados de baja que no están en el archivo de sueldos
        </mat-panel-description>
      </mat-expansion-panel-header>
      <mat-list role="list">
        <mat-list-item *ngFor="let r of response['afiliacion']['bajas_aprobadas']" role="listitem">
          <a target="_blank" [routerLink]="['/persona-admin']" [queryParams]="{legajo:r.per_legajo}">{{r.per_legajo}} {{r.per_nombres}} {{r.per_apellidos}}</a>
        </mat-list-item>
      </mat-list>
    </mat-expansion-panel>

    <mat-expansion-panel>
      <mat-expansion-panel-header>
        <mat-panel-title>
          Bajas rechazadas {{response['afiliacion']["bajas_rechazadas"].length}}
        </mat-panel-title>
        <mat-panel-description>
          Registros 40 dados de baja que están en el archivo de sueldos
        </mat-panel-description>
      </mat-expansion-panel-header>
      <mat-list role="list">
        <mat-list-item *ngFor="let r of response['afiliacion']['bajas_aprobadas']" role="listitem">
          <a target="_blank" [routerLink]="['/persona-admin']" [queryParams]="{legajo:r.per_legajo}">{{r.per_legajo}} {{r.per_nombres}} {{r.per_apellidos}}</a>
        </mat-list-item>
      </mat-list>
    </mat-expansion-panel>
  </mat-accordion>

  <h3>Registros 80</h3>
  <mat-accordion>
    <mat-expansion-panel>
      <mat-expansion-panel-header>
        <mat-panel-title>
          Altas existentes {{response["tramite_excepcional"]["altas_existentes"].length}}
        </mat-panel-title>
        <mat-panel-description>
          Registros 80 existentes que están en el archivo de sueldos
        </mat-panel-description>
      </mat-expansion-panel-header>
      <mat-list role="list">
        <mat-list-item *ngFor="let r of response['tramite_excepcional']['altas_existentes']" role="listitem">
          <a target="_blank" [routerLink]="['/persona-admin']" [queryParams]="{legajo:r.per_legajo}">{{r.per_legajo}} {{r.per_nombres}} {{r.per_apellidos}}</a>
        </mat-list-item>
      </mat-list>
    </mat-expansion-panel>

    <mat-expansion-panel>
      <mat-expansion-panel-header>
        <mat-panel-title>
          Altas aprobadas {{response['tramite_excepcional']["altas_aprobadas"].length}}
        </mat-panel-title>
        <mat-panel-description>
          Registros 80 enviados que están en el archivo de sueldos
        </mat-panel-description>
      </mat-expansion-panel-header>
      <mat-list role="list">
        <mat-list-item *ngFor="let r of response['tramite_excepcional']['altas_aprobadas']" role="listitem">
          <a target="_blank" [routerLink]="['/persona-admin']" [queryParams]="{legajo:r.per_legajo}">{{r.per_legajo}} {{r.per_nombres}} {{r.per_apellidos}}</a>
        </mat-list-item>
      </mat-list>
    </mat-expansion-panel>
  
  
  <mat-expansion-panel>
    <mat-expansion-panel-header>
      <mat-panel-title>
        Altas rechazadas {{response['tramite_excepcional']["altas_rechazadas"].length}}
      </mat-panel-title>
      <mat-panel-description>
        Registros 80 enviados que no están en el archivo de sueldos
      </mat-panel-description>
    </mat-expansion-panel-header>
    <mat-list role="list">
      <mat-list-item *ngFor="let r of response['tramite_excepcional']['altas_rechazadas']" role="listitem">
        <a target="_blank" [routerLink]="['/persona-admin']" [queryParams]="{legajo:r.per_legajo}">{{r.per_legajo}} {{r.per_nombres}} {{r.per_apellidos}}</a>
      </mat-list-item>
    </mat-list>
  </mat-expansion-panel>

  <mat-expansion-panel>
    <mat-expansion-panel-header>
      <mat-panel-title>
        Altas automáticas {{response['tramite_excepcional']["altas_automaticas"].length}}
      </mat-panel-title>
      <mat-panel-description>
        Registros 80 no enviados que están en el archivo de sueldos
      </mat-panel-description>
    </mat-expansion-panel-header>
    <mat-list role="list">
      <mat-list-item *ngFor="let r of response['tramite_excepcional']['altas_automaticas']" role="listitem">
        <a target="_blank" [routerLink]="['/persona-admin']" [queryParams]="{legajo:r.legajo}">{{r.legajo}} {{r.nombres}} {{r.apellidos}}</a>
      </mat-list-item>
    </mat-list>
  </mat-expansion-panel>


  <mat-expansion-panel>
    <mat-expansion-panel-header>
      <mat-panel-title>
        Bajas automáticas {{response['tramite_excepcional']["bajas_automaticas"].length}}
      </mat-panel-title>
      <mat-panel-description>
        Registros 80 existentes que no están en el archivo de sueldos
      </mat-panel-description>
    </mat-expansion-panel-header>
    <mat-list role="list">
      <mat-list-item *ngFor="let r of response['tramite_excepcional']['bajas_automaticas']" role="listitem">
        <a target="_blank" [routerLink]="['/persona-admin']" [queryParams]="{legajo:r.per_legajo}">{{r.per_legajo}} {{r.per_nombres}} {{r.per_apellidos}}</a>
      </mat-list-item>
    </mat-list>
  </mat-expansion-panel>

  <mat-expansion-panel>
    <mat-expansion-panel-header>
      <mat-panel-title>
        Bajas aprobadas {{response['tramite_excepcional']["bajas_aprobadas"].length}}
      </mat-panel-title>
      <mat-panel-description>
        Registros 80 dados de baja que no están en el archivo de sueldos
      </mat-panel-description>
    </mat-expansion-panel-header>
    <mat-list role="list">
      <mat-list-item *ngFor="let r of response['tramite_excepcional']['bajas_aprobadas']" role="listitem">
        <a target="_blank" [routerLink]="['/persona-admin']" [queryParams]="{legajo:r.per_legajo}">{{r.per_legajo}} {{r.per_nombres}} {{r.per_apellidos}}</a>
      </mat-list-item>
    </mat-list>
  </mat-expansion-panel>

  <mat-expansion-panel>
    <mat-expansion-panel-header>
      <mat-panel-title>
        Bajas rechazadas {{response['tramite_excepcional']["bajas_rechazadas"].length}}
      </mat-panel-title>
      <mat-panel-description>
        Registros 80 dados de baja que están en el archivo de sueldos
      </mat-panel-description>
    </mat-expansion-panel-header>
    <mat-list role="list">
      <mat-list-item *ngFor="let r of response['tramite_excepcional']['bajas_aprobadas']" role="listitem">
        <a target="_blank" [routerLink]="['/persona-admin']" [queryParams]="{legajo:r.per_legajo}">{{r.per_legajo}} {{r.per_nombres}} {{r.per_apellidos}}</a>
      </mat-list-item>
    </mat-list>
  </mat-expansion-panel>
  </mat-accordion>
  
  <h3>Errores</h3>
  <mat-accordion>
    <mat-expansion-panel>
      <mat-expansion-panel-header>
        <mat-panel-title>
          Errores {{response["errors"].length}}
        </mat-panel-title>
        <mat-panel-description>
          Errores en el procesamiento del archivo
        </mat-panel-description>
      </mat-expansion-panel-header>
      <mat-list role="list">
        <mat-list-item *ngFor="let r of response['errors']" role="listitem">{{r}}</mat-list-item>
      </mat-list>
    </mat-expansion-panel>
  </mat-accordion>

  </mat-card-content>  
</mat-card>

<mat-card *ngIf="response">
  <mat-card-content>
    <button mat-raised-button [disabled]="saveStatus != 'unsaved'" type="button" (click)="save()" color="primary">Guardar</button>&nbsp;
    <button mat-raised-button [disabled]="saveStatus == 'saving'" color="accent" type="button" (click)="finalize()">Finalizar</button>
  </mat-card-content>
</mat-card>

<mat-progress-bar *ngIf="saveStatus == 'saving'"
          [color]="'warn'"
          [mode]="'determinate'"
          [value]="progress"
          >
</mat-progress-bar>
<!--p>Debug Form value: {{ uploadForm.value | json }}</p>
<p>Debug Form status: {{ uploadForm.status | json }}</p-->
